/*!
 * democapsid v2.2.0 - Render viral capsids in the browser and export SVG.
 * MIT License
 * Copyright (c) 2020 - 2024, Daniel Antonio Negrón (dnanto/remaindeer)
 */
const t="2.2.0",e=Math.sqrt(3),r=Math.sqrt(5),o=(1+r)/2,a=100,n=1e-15,s=1e-5;function mmul(t,e){const[r,o,a]=[t.length,t[0].length,e[0].length];for(var n=new Array(r),s=0;s<r;s++)n[s]=new Array(a).fill(0);for(s=0;s<r;s++)for(var i=0;i<a;i++)for(var c=0;c<o;c++)n[s][i]+=t[s][c]*e[c][i];return n}function det2(t){return t[0][0]*t[1][1]-t[0][1]*t[1][0]}function det3(t){return t[0][0]*(t[1][1]*t[2][2]-t[1][2]*t[2][1])-t[0][1]*(t[1][0]*t[2][2]-t[1][2]*t[2][0])+t[0][2]*(t[1][0]*t[2][1]-t[1][1]*t[2][0])}function inv2(t){const e=det2(t);return[[t[1][1],-t[0][1]].div(e),[-t[1][0],t[0][0]].div(e)]}function inv3(t){const[e,r,o,a,n,s,i,c,l]=[t[0][0],t[0][1],t[0][2],t[1][0],t[1][1],t[1][2],t[2][0],t[2][1],t[2][2]],d=this.det3(t);return[[(n*l-s*c)/d,-(r*l-o*c)/d,(r*s-o*n)/d],[-(a*l-s*i)/d,(e*l-o*i)/d,-(e*s-o*a)/d],[(a*c-n*i)/d,-(e*c-r*i)/d,(e*n-r*a)/d]]}function T(t){for(var e=Array.from({length:t[0].length},(()=>Array.from({length:t.length},(()=>[])))),r=0;r<e.length;r++)e[r]=new Array(t.length);for(r=0;r<t.length;r++)for(var o=0;o<t[0].length;o++)e[o][r]=t[r][o];return e}function rotmat3(t,e,r){const[o,a,n,s,i,c]=[Math.sin(t),Math.sin(e),Math.sin(r),Math.cos(t),Math.cos(e),Math.cos(r)];return[[s*i,s*a*n-o*c,s*a*c+o*n],[o*i,o*a*n+s*c,o*a*c-s*n],[-a,i*n,i*c]]}function camera(t,e,r,o=[0,0,0]){const a=rotmat3(t,e,r),n=[[1,0,0,-o[0]],[0,1,0,-o[1]],[0,0,1,-o[2]]];return mmul(mmul([[1,0,0],[0,1,0],[0,0,1]],a),n)}function*brackets(t,e,r,o){const a=r/o;let n=Math.sign(t(e));for(let s=0;s<o;s++){let r=e+s*a,o=Math.sign(t(r));n!=o&&(yield[e+(s-1)*a,r],n=o)}}function bisection(t,e,r,o,a){let n=1,s=(e+r)/2,i=t(s);for(;n<=a&&(s=(e+r)/2,i=t(s),!(0==i||(r-e)/2<o));n++)Math.sign(i)==Math.sign(t(e))?e=s:r=s;return[n,i,s]}function degrees(t){return 180*t/Math.PI}function radians(t){return t*Math.PI/180}function calc_tile(t,r){const o=r*(e/2);let a;if("hex"===t)a={basis:[[2*o,0],[o,e*o]],tile:t=>[new paper.Path.RegularPolygon({center:t.coor,sides:6,radius:r,data:{mer:1}})],radius:r};else if("trihex"===t)a={basis:[[2*r,0],[r,r*e]],tile:t=>[new paper.Path.RegularPolygon({center:t.coor,sides:6,radius:r,data:{mer:1}}).rotate(30),...Array.from({length:2},((e,a)=>new paper.Path.RegularPolygon({center:t.coor.add([r,-1/3*o]),sides:3,radius:2/3*o,data:{mer:2}}).rotate(180).rotate(60*a,t.coor)))],radius:2*o};else if("snubhex"===t)a={basis:[[2.5*r,o],[.5*r,3*o]],tile:t=>[new paper.Path.RegularPolygon({center:t.coor,sides:6,radius:r,data:{mer:1}}).rotate(30),...Array.from({length:6},((e,r)=>new paper.Path.RegularPolygon({center:t.coor.add([0,-o-1/3*o]),sides:3,radius:2/3*o,data:{mer:2}}).rotate(60*r,t.coor))),new paper.Path.RegularPolygon({center:t.coor.add([1.5*r,-1/3*o]),sides:3,radius:2/3*o,data:{mer:2}}),new paper.Path.RegularPolygon({center:t.coor.add([-1.5*r,2/3*o]),sides:3,radius:2/3*o,data:{mer:2}}).rotate(180)],radius:2*o};else if("rhombitrihex"===t)a={basis:[[r+o+.5*r,.5*r+o],[0,2*o+r]],tile:t=>[new paper.Path.RegularPolygon({center:t.coor,sides:6,radius:r,data:{mer:1}}).rotate(30),...Array.from({length:3},((o,a)=>new paper.Path.RegularPolygon({center:t.coor.add([0,r+r*(e/3)]),sides:3,radius:r/e,data:{mer:2}}).rotate(-60*a-30,t.coor))),...Array.from({length:3},((e,a)=>new paper.Path.RegularPolygon({center:t.coor.add([0,-o-.5*r]),sides:4,radius:Math.sqrt(2*r*r)/2,data:{mer:3}}).rotate(60*a,t.coor)))],radius:Math.sqrt(Math.pow(o+r,2)+Math.pow(r/2,2))};else if("dualhex"===t)a={basis:[[1.5*r,o],[0,2*o]],tile:t=>Array.from({length:6},((a,n)=>new paper.Path.RegularPolygon({center:t.coor.add([0,o-r*e/6]),sides:3,radius:r/e,data:{mer:1}}).rotate(60*n,t.coor))),radius:r};else if("dualtrihex"===t)a={basis:[[2*o,0],[o,e*o]],tile:t=>[...Array.from({length:6},((e,a)=>new paper.Path({segments:[[0,0],[.5*o,-.25*r*Math.sin(Math.PI/6)/Math.cos(Math.PI/3)],[o,0],[.5*o,.25*r*Math.sin(Math.PI/6)/Math.cos(Math.PI/3)]].map((e=>t.coor.add(e))),closed:!0,data:{mer:1}}).rotate(60*a,t.coor))),...Array.from({length:6},((e,a)=>new paper.Path({segments:[[-.5*o,.5*r+.25*r*Math.sin(Math.PI/6)/Math.cos(Math.PI/3)],[0,.5*r],[o-.5*o,.5*r+.25*r*Math.sin(Math.PI/6)/Math.cos(Math.PI/3)],[0,.5*r+.25*r*Math.sin(Math.PI/6)*2/Math.cos(Math.PI/3)]].map((e=>t.coor.add(e))),closed:!0,data:{mer:2}}).rotate(60*a,t.coor)))],radius:r};else if("dualsnubhex"===t)a={basis:[[2.5*r,o],[.5*r,2*o+r*e/3*2-r*e/6]],tile:t=>Array.from({length:6},((a,n)=>new paper.Path({segments:[[0,0],[0,o+r*e/6],[.5*r,o+r*e/3],[r,o+r*e/6],[r,r*e/3]].map((e=>t.coor.add(e))),closed:!0,data:{mer:1}}).rotate(60*n,t.coor))),radius:o+r*e/3};else{if("dualrhombitrihex"!==t)throw new Error("incorrect tile mode");a={basis:[[1.5*r,o],[0,2*o]],tile:t=>Array.from({length:6},((a,n)=>new paper.Path({segments:[[0,0],[0,o],[.5*r,o],[e/2*o,.5*o]].map((e=>t.coor.add(e))),closed:!0,data:{mer:1}}).rotate(60*n,t.coor))),radius:r}}return a}function*tile_grid(t,e){const r=t.map((t=>mmul(T(inv2(e)),[t,1].flat().T()).flat())).map((t=>t.map(Math.round))),[o,a,n,s]=[...[0,1].map(((t,e)=>Math.min(...r.map((t=>t[e]))))),...[0,1].map(((t,e)=>Math.max(...r.map((t=>t[e])))))];for(let i=o;i<n+1;i++)for(let t=a;t<s+1;t++)yield{index:[i,t],coor:e[0].mul(i).add(e[1].mul(t)),is_vertex:r.has([i,t])}}function ck_vectors(t,e,r,o,a){const[n,s]=t,i=s.rot(Math.PI/3);return[n.mul(e).add(s.mul(r)),s.mul(o).add(i.mul(a)),n.mul(-e-r).add(s.mul(e)),n.mul(r).add(i.mul(-e))]}function triangle_circumcircle_center(t,e,r){const[o,a]=[t.sub(r),e.sub(r)],n=o.cross(a);return a.mul(o.norm()**2).sub(o.mul(a.norm()**2)).cross(n).div(2*n.norm()**2).add(r)}function tetrahedron_circumsphere_center(t,e,r,o){const[a,n,s]=[e,r,o].map((e=>e.sub(t)));return t.add(a.cross(n).mul(s.norm()**2).add(s.cross(a).mul(n.norm()**2)).add(n.cross(s).mul(a.norm()**2)).div(2*det3([a,n,s])))}function body_radius(t){return t[6].sub([0,0,t[6][2]]).norm()}function height(t){return t[0][2]-t[19][2]}function body_height(t){return t[4][2]-t[6][2]}function sd_sphere(t,e){return t.norm()-e}function spherize(t,e,r){return t.uvec().mul(Math.abs(sd_sphere(t,e))*r).add(t)}function cylinderize(t,e,r,o){const[a,n]=[body_radius(e),body_height(e)/2];let s,i;if(5===r)s=[0,0,n-a/2],i=e[0][2]+a/2-n;else if(3===r){const[t,r]=[e[0],e[3]];s=triangle_circumcircle_center(t,r,[r[0],-r[1],r[2]]),i=t.sub(s).norm()}else 2===r&&(p1=e[0],s=tetrahedron_circumsphere_center(p1,...[1,4,5].map((t=>e[t]))),i=p1.sub(s).norm());const[c,l,d,u]=[[0,0,s[2]],[0,0,-s[2]],[0,0,n],[0,0,-n]];if(n<t[2]){const e=Math.abs(sd_sphere(t.sub(c),i));return t.sub(d).uvec().mul(e*o).add(t)}if(t[2]<-n){const e=Math.abs(sd_sphere(t.sub(l),i));return t.sub(u).uvec().mul(e*o).add(t)}return t.sub([0,0,t[2]]).uvec().mul((a-t.slice(0,2).norm())*o).add(t)}function ico_config(t){let e;if(5===t)e=[[1,1,2,2],["T1-▲","T1-▼","T2-▲","T2-▼"],[[0,1,2],[6,11,7],[2,1,6],[6,7,2]],[5,5,5,5],[[1,2,3,4,5],[0,2,5,6,10],[0,1,3,6,7],[0,2,4,7,8],[0,3,5,8,9],[0,1,4,9,10],[1,2,7,10,11],[2,3,6,8,11],[3,4,7,9,11],[4,5,8,10,11],[1,5,6,9,11],[6,7,8,9,10]]];else if(3===t)e=[[1,1,1,1,2,2,3,3],["T1-▔","T1-▲","T1-▼","T1-▁","T2-▼","T2-▲","T3-▼","T3-▲"],[[0,2,1],[1,2,3],[6,9,11],[9,10,11],[1,3,6],[9,6,3],[1,6,5],[11,5,6]],[1,3,3,1,3,3,3,3],[[1,2,4,5,8],[0,2,3,5,6],[0,1,3,4,7],[1,2,6,7,9],[0,2,7,8,10],[0,1,6,8,11],[1,3,5,9,11],[2,3,4,9,10],[0,4,5,10,11],[3,6,7,10,11],[4,7,8,9,11],[5,6,8,9,10]]];else{if(2!==t)throw new Error("a must be 2, 3, or 5");e=[[1,1,1,1,2,2,2,2,3,3],["T1-▔","T1-▔","T1▁","T1▁","T2-▼","T2-▲","T2-▼","T2-▲","T3-▼","T3-▲"],[[0,1,2],[2,1,4],[9,10,6],[9,11,10],[0,2,6],[9,6,2],[2,4,9],[11,9,4],[0,6,5],[10,5,6]],[2,2,2,2,2,2,2,2,2,2],[[1,2,3,5,6],[0,2,3,4,7],[0,1,4,6,9],[0,1,5,7,8],[1,2,7,9,11],[0,3,6,8,10],[0,2,5,9,10],[1,3,4,8,11],[3,5,7,10,11],[2,4,6,10,11],[5,6,8,9,11],[4,7,8,9,10]]]}return Object.fromEntries(["t_idx","t_id","v_idx","t_rep","v_con"].map(((t,r)=>[t,e[r]])))}function ico_axis_5(t){const[e,o]=[t[0].norm(),t[1].norm()],a=e*Math.sqrt((5+r)/10),n=[0,0,(1+r)*e/(2*Math.sqrt(5+2*r))],s=[-a,0,0].roro([0,0,1],.3*Math.PI),i=s.add([e,0,0]),c=t[0].angle(t[1]),l=i.add([o,0,0].roro([0,1,0],-Math.PI-c)),d=s.add(l.sub(s).proj(i.sub(s))),u=[d[0],-Math.abs(d[1])*Math.sqrt(a*a*d[1]*d[1]-(d[0]*d[1])**2)/(d[1]*d[1]),0];if(Number.isNaN(u[1]))throw new Error("impossible construction!");const p=u.add([0,0,-Math.sqrt(l[2]*l[2]-(d[1]-u[1])**2)]);return[n,s,i].concat([1,2,3].map((t=>i.roro([0,0,1],2*t/5*Math.PI)))).concat([p]).concat([1,2,3,4].map((t=>p.roro([0,0,1],2*t/5*Math.PI)))).concat([[0,0,p[2]-n[2]]]).map((t=>t.add([0,0,-p[2]/2])))}function ico_axis_3(t,r=a,o=n){const[s,i,c]=[t[0].norm(),t[1].norm(),t[2].sub(t[1]).norm()],l=[0,s*(1/e),0],d=[s/2,-s*(e/6),0],u=[-s/2,-s*(e/6),0],p=[0,-s*(2*e/3),0];function fold(a){let[n,l]=[p.uvec().mul(s*(e/2)),d.sub(u).uvec()];const h=[0,-s*(e/6),0].add(n.roro(l,a)),m=h.roro([0,0,1],2/3*Math.PI);a=t[0].angle(t[1]),[n,l]=[h.sub(d).uvec().mul(i),h.cross(d).uvec()];const _=n.roro(l,a),[g,b]=[d.add(_.proj(n)),d.add(_)];[n,l]=[b.sub(g),d.sub(h).uvec()];const f=t=>c-g.add(n.roro(l,t)).sub(m).norm();brackets(f,0,2*Math.PI,r).next().value;a=bisection(f,...brackets(f,0,2*Math.PI,r).next().value,o,r).slice(-1);const y=g.add(n.roro(l,a));return[h,m,y,Math.abs(h[1])-y.sub([0,0,y[2]]).norm()]}const h=Math.PI/180/10;let m=0;for(let e=0;e*h<Math.PI/2;e++){m=e*h;try{fold(m);break}catch(P){}}let obj=t=>fold(t).slice(-1)[0];try{m=bisection(obj,...brackets(obj,m,Math.PI/4,r).next().value,o,r).slice(-1)}catch(P){throw new Error("impossible construction!")}const[_,g,b]=fold(m).slice(0,-1);if(Number.isNaN(_[0]))throw new Error("impossible construction!");const y=[0,0,1];m=2*Math.PI/3;const M=b.roro(y,-m),w=M.sub([0,0,M[2]]).roro(y,Math.PI/3).uvec().mul(l[1]).add([0,0,M[2]+_[2]-l[2]]);let v=[l,d,u,_,g.roro(y,m),g,b,M,M.roro(y,-m),w,w.roro(y,-m),w.roro(y,-2*m)];return v.map((t=>t.add([0,0,(v[0][2]-v.slice(-1)[0][2])/2])))}function ico_axis_2(t,e=a,r=n){const[s,i,c]=[t[0].norm(),t[1].norm(),t[2].sub(t[1]).norm()],l=[s/2,0,0],d=[-s/2,0,0],u=[0,-s*o/2,-(s*o-s)/2],p=[0,s*o/2,-(s*o-s)/2];function fold(o){let a=d.add(u).div(2),[n,s]=[a.sub(l),u.sub(d).uvec()];const p=a.add(n.roro(s,o)),h=p.roro([0,0,1],Math.PI);o=t[0].angle(t[1]),[n,s]=[u.sub(l).uvec().mul(i),u.cross(l).uvec()];const m=n.roro(s,o);a=l.add(m.proj(n));const _=l.add(m);[n,s]=[_.sub(a),l.sub(u).uvec()];const f=t=>c-a.add(n.roro(s,t)).sub(h).norm();o=bisection(f,...brackets(f,0,2*Math.PI,e).next().value,r,e).slice(-1);const g=a.add(n.roro(s,o));return[p,h,g,p.sub([0,0,p[2]]).norm()-g.sub([0,0,g[2]]).norm()]}const h=Math.PI/180/10;let m=0;for(let o=0;o*h<Math.PI/2;o++){m=o*h;try{fold(m);break}catch(w){}}let obj=t=>fold(t).slice(-1)[0];try{m=bisection(obj,...brackets(obj,m,Math.PI/4,e).next().value,r,e).slice(-1)}catch(w){throw new Error("impossible construction!")}const[_,g,b]=fold(m).slice(0,-1);if(Number.isNaN(_[0]))throw new Error("impossible construction!");obj=t=>l.roro([0,0,1],t).add([0,0,b[2]+_[2]]).sub(g).norm()-i;try{m=bisection(obj,...brackets(obj,0,2*Math.PI,e).next().value,r,e).slice(-1)}catch(w){throw new Error("impossible construction!")}const y=l.roro([0,0,1],m).add([0,0,b[2]+_[2]]),M=y.sub([0,0,y[2]]).uvec().roro([0,0,1],Math.PI/2).mul(p[1]).add([0,0,b[2]+_[2]-p[2]]);return coor=[l,d,u,p,_,g,b,b.roro([0,0,1],Math.PI),M,M.roro([0,0,1],Math.PI),y,y.roro([0,0,1],Math.PI)],coor.map((t=>t.add([0,0,(coor[0][2]-coor.slice(-1)[0][2])/2])))}function model_sa_error(t){const e=ck_vectors(calc_tile(t.t,t.R).basis,t.h,t.k,t.H,t.K),r=[[e[3],e[0]],[e[0],e[1]],[e[1],e[2]]],o=["","",ico_axis_2,ico_axis_3,"",ico_axis_5][t.a](e,a,n),s=ico_config(t.a),i=s.t_id.map((t=>parseInt(t[1]))).reduce(((t,e)=>t<e?e:t)),c=Array.from({length:i}).fill(0);s.t_id.forEach(((t,e)=>c[t[1]-1]+=s.t_rep[e]));const l=r.slice(0,i).map(((t,e)=>[...t[0],0].cross([...t[1],0]).norm()/2*c[e])).sum();return(l-s.v_idx.map((t=>t.map((t=>o[t])))).map(((t,e)=>t[1].sub(t[0]).cross(t[2].sub(t[0])).norm()/2*s.t_rep[e])).sum())/l}function lattice_config(t,e,r,o,a,n){const s=calc_tile(n,a),i=ck_vectors(s.basis,t,e,r,o),c=Array.from(tile_grid(i,s.basis)),l=c.map(s.tile),d=c.filter((t=>t.is_vertex)).map((t=>t.coor)).concat([[0,0]]);return l.flat().forEach((t=>{t.data.offset=t.data.mer+(d.some((e=>[t.position.x,t.position.y].sub(e).norm()<=s.radius))?0:3),t.data.centroid=t.segments.map((t=>t.point)).reduce(((t,e)=>t.add(e))).divide(t.segments.length)})),{tile:s,ck:i,lattice:l}}function calc_facets(t,e){const r=[[3,0],[0,1],[1,2]].map((e=>[t.ck[e[0]],t.ck[e[1]]])).map((t=>new paper.Path({segments:[[0,0],...t],closed:!0,data:{vectors:[[0,0],...t]}}))),o=r.map((r=>new paper.Group({children:t.lattice.flatMap((t=>t.map((t=>{const o=t.curves.map((t=>[t.segment1.point,t.segment2.point])),a=t.intersect(r,{insert:!1});return a.data.has_centroid=r.contains(a.data.centroid),a.data.centroid_on_vertex=a.segments.findIndex((t=>t.point.getDistance(a.data.centroid)<1e-5))>-1,a.style.fillColor=e["mer_color_"+a.data.offset]+e["mer_alpha_"+a.data.offset],a.data.strokes=a.curves.map((t=>[t.segment1.point,t.segment2.point])).map(((t,e)=>o.some((e=>[0,1].every((r=>e[0].subtract(t[r]).cross(e[1].subtract(t[r]))<1e-5))&&e[0].subtract(e[1]).isCollinear(t[0].subtract(t[1]))))?e:-1)).split(-1).map((t=>(t.push((t[t.length-1]+1)%a.curves.length),t))),a})))).sort(((t,e)=>t.data.offset-e.data.offset)).filter((t=>t.segments.length>0)),data:r.data})));return r.forEach((t=>t.remove())),o}function draw_lattice(t){const[e,r,o,a,n,s]=["h","k","H","K","R","t"].map((e=>t[e])),i=lattice_config(e,r,o,a,n,s);return i.lattice.flat().forEach((e=>e.style.fillColor=t["mer_color_"+e.data.offset]+t["mer_alpha_"+e.data.offset])),new paper.Group(new paper.Group({children:i.lattice.flat(),position:paper.view.center,style:{strokeColor:t.line_color+t.line_alpha,strokeWidth:t.line_size,strokeCap:"round",strokeJoin:"round"}}))}function draw_facets(t){const[e,r,o,a,n,s]=["h","k","H","K","R","t"].map((e=>t[e])),i=lattice_config(e,r,o,a,n,s),c=new paper.Group({children:calc_facets(i,t),position:paper.view.center});return i.lattice.forEach((t=>t.forEach((t=>t.remove())))),t.facet_toggle?(c.style.strokeColor=t.line_color+t.line_alpha,c.style.strokeWidth=t.line_size,c.style.strokeCap="round",c.style.strokeJoin="round",c):(c.remove(),new paper.Group({children:c.children.map((e=>new paper.Group(e.children.map((e=>{const r=e.segments.map((t=>t.point)),o=new paper.Group(e.data.strokes.map((e=>new paper.Path({segments:e.map((t=>r[t])),closed:!1,style:{strokeColor:t.line_color,strokeWidth:t.line_size}}))));return new paper.Group([e.clone(),o])}))))),style:{strokeCap:"round",strokeJoin:"round"}}))}function draw_net(t){const[e,r,o,a,n,s]=["h","k","H","K","R","t"].map((e=>t[e])),i=lattice_config(e,r,o,a,n,s),c=i.ck,l=calc_facets(i,t);let d;if(5===t.a){const t=new paper.Group(l.slice(0,2)).rotate(-degrees(c[0].angle([1,0]))).scale(-1,1),e=t.clone().rotate(180),r=e.children[1].children.flatMap((t=>t.segments)).map((t=>t.point)).reduce(((t,e)=>t.y<e.y?t:e));e.position.x+=t.children[0].bounds.right-r.x,e.position.y+=t.children[0].bounds.height,d=new paper.Group({children:Array.from({length:5}).flatMap(((r,o)=>{const[a,n]=[t.clone(),e.clone()];return a.position.x+=o*t.children[0].bounds.width,n.position.x+=o*t.children[0].bounds.width,[a,n]})).flatMap((t=>t.children)),position:paper.view.center}),[t,e].forEach((t=>t.remove()))}else if(3===t.a){const t=c[0].angle([1,0]),e=new paper.Group(l).rotate(-degrees(t)).scale(-1,1),r=l[0].clone().rotate(180);r.position.x+=c[0].norm()/2;const o=[r.bounds.topLeft,r.bounds.topRight,r.bounds.bottomCenter].reduce(((t,e)=>t.add(e))).divide(3),a=r.bounds.topRight.add(new paper.Point([1,0].mul(c[1].norm()).rot(-(Math.PI/3-c[1].angle(c[2]))))),n=r.bounds.topRight.add(new paper.Point([1,0].mul(c[2].norm()).rot(-(Math.PI/3-c[1].angle(c[2])+c[1].angle(c[2]))))),s=new paper.Group([...[1,2,3].map(((t,r)=>e.clone().rotate(120*r,o)))]);s.children.slice(0,-1).forEach((t=>t.children[1].remove()));const i=s.clone().rotate(180);i.bounds.left=Math.min(a.x,n.x),i.bounds.bottom=r.bounds.topRight.y,i.position.y-=i.children[1].children[0].bounds.bottom-a.y,i.children.forEach((t=>s.addChild(t.clone()))),s.position=paper.view.center,d=new paper.Group({children:s.children.flatMap((t=>t.children.flat()))}),[r,e,i].forEach((t=>t.remove()))}else{if(2!==t.a)throw new Error("invalid symmetry mode!");{const t=c[0].angle([1,0]),e=new paper.Group(l).rotate(-degrees(t)).rotate(-60).scale(-1,1),r=e.children[1].clone(),o=e.children[0].bounds.topLeft.subtract(e.children[0].bounds.bottomCenter);r.position=r.position.add(o);const a=new paper.Group([e.clone(),e.children[0].clone().rotate(60,e.children[0].bounds.topRight),r.clone()]),n=a.clone().rotate(180,a.children[0].children[0].bounds.topRight);n.position=n.position.add(o.rotate(240));const s=new paper.Group([a,n]),i=s.children[0].children[2].children.filter((t=>1===t.data.offset)).flatMap((t=>t.segments.map((t=>t.point)))).filter((t=>Math.abs(t.getDistance(s.children[0].children[1].bounds.bottomLeft)-c[1].norm())<1e-5)).reduce(((t,e)=>t.y<e.y?e:t)),u=s.clone();u.position=u.position.add(s.children[1].children[0].children[0].bounds.bottomRight.subtract(i));const p=new paper.Group([s,u]);p.position=paper.view.center;const h=p.children.flatMap((t=>t.children)).flatMap((t=>t.children));d=new paper.Group({children:[...h.filter(((t,e)=>e%3==0)).flatMap((t=>t.children)),...h.filter(((t,e)=>e%3!=0))]}),[2,5,8,11].forEach((t=>d.children[t].remove())),[e,r,a,n,s,u].forEach((t=>t.remove()))}}return d.scale(-1,1),l.forEach((t=>t.remove())),i.lattice.forEach((t=>t.forEach((t=>t.remove())))),t.facet_toggle?(d.style.strokeColor=t.line_color+t.line_alpha,d.style.strokeWidth=t.line_size,d.style.strokeCap="round",d.style.strokeJoin="round",d):(d.remove(),new paper.Group({children:d.children.map((e=>new paper.Group(e.children.map((e=>{const r=e.segments.map((t=>t.point)),o=new paper.Group(e.data.strokes.map((e=>new paper.Path({segments:e.map((t=>r[t])),closed:!1,style:{strokeColor:t.line_color,strokeWidth:t.line_size}}))));return new paper.Group([e.clone(),o])}))))),style:{strokeCap:"round",strokeJoin:"round"}}))}function draw_capsid(t){const[e,r,o,i,c,l]=["h","k","H","K","R","t"].map((e=>t[e])),d=lattice_config(e,r,o,i,c,l),u=calc_facets(d,t),p=ico_config(t.a),h=["","",ico_axis_2,ico_axis_3,"",ico_axis_5][t.a](d.ck,a,n),m=2*Math.PI/t.a,_=e==o&&r==i?e=>spherize(e,h[0].norm(),t.s):e=>cylinderize(e,h,t.a,t.s),g=camera(...[t.θ,t.ψ,t.φ].map(radians));let b=[];for(let a=0,n=0;a<p.t_idx.length;a++){const t=u[p.t_idx[a]-1],e=inv3(T(t.data.vectors.map((t=>t.concat(1))))),r=[0,1,2].map((t=>h[p.v_idx[a][t]]));for(let o=0;o<p.t_rep[a];o++,n++){const a=r.map((t=>t.roro([0,0,1],o*m))),s=mmul(T(a),e),i=t.children.map((t=>{const e=t.segments.map((t=>[t.point.x,t.point.y,1])).map((t=>mmul(s,t.T()).flat())).map((t=>_(t))).map((t=>mmul(g,t.concat(1).T()).flat())),r=mmul(g,_(mmul(s,[t.data.centroid.x,t.data.centroid.y,1].T()).flat()).concat(1).T()).flat();return new paper.Path({segments:e.map((t=>t.slice(0,2))),closed:t.closed,data:Object.assign({},t.data,{id:n,centroid:r,segments_3D:e,normal:e[1].sub(e[0]).cross(e[2].sub(e[0])).uvec()}),style:t.style})}));b=b.concat(new paper.Group({children:i,data:{type:"facet",centroid:mmul(g,_(a.centroid()).concat(1).T()).flat()}}))}}const y=h.map((t=>mmul(g,t.concat(1).T()).flat()));let M=t.penton_fiber_toggle?p.v_con.map((t=>t.map((t=>y[t])).reduce(((t,e)=>t.add(e)),[0,0,0]).uvec())).map(((e,r)=>[y[r],y[r].add(e.mul(t.fiber_length))])):[];M=M.concat(b.flatMap((t=>t.children)).filter((e=>t["mer_toggle_"+e.data.offset]&&e.data.has_centroid)).map((e=>{const r=e.data.centroid;return[r,r.add(e.data.normal.mul(t.fiber_length))]})));let w=[];M.forEach((t=>{let e=0;for(let r of w)t[0].sub(r[0][0]).norm()<s&&(e=r.push(t));0===e&&w.push([t])})),M=w.map((t=>[t[0][0],t.map((t=>t[1])).reduce(((t,e)=>t.add(e)),[0,0,0]).div(t.length)])).map((t=>new paper.Path.Line({from:t[0],to:t[1],data:{centroid:t[1].mul(2)}})));const v=t.knob_toggle?M.map((e=>new paper.Path.Circle({center:e.segments[1].point,radius:t.knob_size,data:{centroid:e.data.centroid}}))):[];b=b.concat(M).concat(v),b.sort(((t,e)=>t.data.centroid[2]-e.data.centroid[2]));const P=new paper.Group({children:b,position:paper.view.center,style:{strokeWidth:t.line_size,strokeCap:"round",strokeJoin:"round"}});return v.forEach((e=>{e.style.strokeColor=t.line_color+t.line_alpha,e.style.fillColor=t.knob_color+t.knob_alpha})),M.forEach((e=>{e.style.strokeColor=t.fiber_color+t.fiber_alpha,e.style.strokeWidth=t.fiber_size})),u.forEach((t=>t.remove())),d.lattice.forEach((t=>t.forEach((t=>t.remove())))),t.facet_toggle?(P.children.filter((t=>"facet"===t.data.type)).forEach((e=>{e.style.strokeColor=t.line_color+t.line_alpha,e.style.strokeWidth=t.line_size})),P.style.strokeCap="round",P.style.strokeJoin="round",P):(P.remove(),new paper.Group({children:P.children.map((e=>Object.hasOwn(e.data,"type")&&"facet"===e.data.type?new paper.Group(e.children.map((e=>{const r=e.segments.map((t=>t.point)),o=new paper.Group(e.data.strokes.map((e=>new paper.Path({segments:e.map((t=>r[t])),closed:!1,style:{strokeColor:t.line_color+t.line_alpha,strokeWidth:t.line_size}}))));return new paper.Group([e.clone(),o])}))):e)),style:{strokeCap:"round",strokeJoin:"round"}}))}Array.prototype.mul=function(t){return this.map((e=>e*t))},Array.prototype.div=function(t){return this.map((e=>e/t))},Array.prototype.add=function(t){return this.map(((e,r)=>e+t[r]))},Array.prototype.sub=function(t){return this.map(((e,r)=>e-t[r]))},Array.prototype.dot=function(t){return this.map(((e,r)=>e*t[r])).reduce(((t,e)=>t+e))},Array.prototype.sum=function(t=0){return this.reduce(((t,e)=>t+e),t)},Array.prototype.centroid=function(){return this.reduce(((t,e)=>t.add(e))).div(this.length)},Array.prototype.cross=function(t){return[this[1]*t[2]-this[2]*t[1],this[2]*t[0]-this[0]*t[2],this[0]*t[1]-this[1]*t[0]]},Array.prototype.rot=function(t){const[e,r]=[Math.cos(t),Math.sin(t)];return mmul([[e,-r],[r,e]],this.T()).flat()},Array.prototype.roro=function(t,e){return this.mul(Math.cos(e)).add(t.cross(this).mul(Math.sin(e))).add(t.mul(t.dot(this)).mul(1-Math.cos(e)))},Array.prototype.norm=function(){return Math.sqrt(this.map((t=>t*t)).sum())},Array.prototype.uvec=function(){return this.div(this.norm())},Array.prototype.angle=function(t){return Math.acos(this.dot(t)/(this.norm()*t.norm()))},Array.prototype.proj=function(t){return t.mul(this.dot(t)/t.dot(t))},Array.prototype.T=function(){return this.map((t=>[t]))},Array.prototype.distance=function(t){return this.sub(t).norm()},Array.prototype.has=function(t,e=n){return this.some((r=>r.length===t.length&&r.distance(t)<e))},Array.prototype.split=function(t){return this.reduce((function(t,e){return-1===e?t.push([]):t[t.length-1].push(e),t}),[[]]).filter((t=>t.length))},"undefined"!=typeof exports&&(module.exports={ico_axis_2:ico_axis_2,ico_axis_3:ico_axis_3,ico_axis_5:ico_axis_5});